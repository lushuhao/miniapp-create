"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _iterableToArrayLimit(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return t}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}var program=require("commander"),inquirer=require("inquirer"),fs=require("fs"),path=require("path"),colors=require("ansi-colors"),log=require("fancy-log"),_require=require("../package.json"),name=_require.name,bin=_require.bin,version=_require.version,bins=Object.keys(bin).join(" | "),mpTypes=require("./config");function createFile(){var e,r=_toArray(program.args),t=r[0],n=r.slice(1);console.log(t,n);var o=t.startsWith("./")?t:"./".concat(t,"/"),a=n[0],i=path.basename(t);a.length||a.push(i);var c=a.map(function(e){return createMPFileList(t,e)});extendDir(o),(c=(e=Array.prototype).concat.apply(e,_toConsumableArray(c))).forEach(function(r){".js"===path.extname(r.file)?fs.copyFile(path.resolve(__dirname,r.content),path.resolve(o,r.file),function(e){handleError(e,r)}):fs.writeFile("".concat(o).concat(r.file),r.content,function(e){handleError(e,r)})})}function handleError(e,r){if(e)return log(colors.red("文件创建失败："),r.file),log(colors.red(e));log(colors.green("文件创建成功："),r.file)}function extendDir(e){e&&!fs.existsSync(e)&&e.split("/").reduce(function(e,r){return fs.existsSync(e)||(fs.mkdirSync(e),log(colors.green("创建文件夹："),e)),"".concat(e,"/").concat(r)})}var createMPFileList=function(e,r){var t=program.type;if(!mpTypes.hasOwnProperty(t))return log(colors.red("不支持".concat(t,"该类型的小程序创建, 默认创建wx小程序"))),[];var n=_slicedToArray(mpTypes[t],5),o=n[0],a=n[1],i=n[2],c=n[3],s=n[4],l="",p="",u=program.component||/component/i.test(e);return log(colors.cyanBright("生成小程序组件？"),colors.red(u)),p=u?(l="./template/".concat(s,"/component.js"),'{\n  "component": true\n}'):(l="./template/".concat(s,"/page.js"),'{\n  "navigationBarTitleText": "'.concat(r,'"\n}')),[{file:"".concat(r,".").concat(o),content:l},{file:"".concat(r,".").concat(a),content:p},{file:"".concat(r,".").concat(i),content:'<view class="'.concat(r,'"></view>')},{file:"".concat(r,".").concat(c),content:".".concat(r,"{}")}]};function inputFileName(){inquirer.prompt({type:"input",name:"fileName",message:"请输入生成模版文件名称? file",default:"index"}).then(function(e){program.args.push([e.fileName]),createFile()})}function inputDirPath(){var r="pages/index",e={type:"input",name:"dirPath",message:"请输入生成模版目录地址?",default:r};inquirer.prompt(e).then(function(e){program.args=[e.dirPath||r],inputFileName()})}function selectType(){var e={type:"list",name:"type",message:"选择想要创建的小程序模版类型",choices:Object.keys(mpTypes)};inquirer.prompt(e).then(function(e){program.type=e.type,inputDirPath()})}program.usage("[command] <options ...>"),program.version(version).option("-v, --version","show ".concat(name," current version")).option("-t, --type <type>","select mini program type, ps: default wx swan my tt xm","wx").option("-c, --component","create component dir").arguments("<path> [file...]").description("".concat(bins," <path> [file...] \n  create one dir to ./path\n  create four files file.js、file.json、file.css、file.html")).action(createFile),program.parse(process.argv),2===process.argv.length?selectType():0===program.args.length&&inputDirPath();